(function(x,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(x=typeof globalThis<"u"?globalThis:x||self,n(x.VueDndHooks={},x.Vue))})(this,function(x,n){"use strict";let q=!1,H;const M=()=>(q||(H=n.effectScope(!0).run(()=>({isDragging:n.computed(()=>H.draggingElements.value.length>0),activeContainer:{component:n.ref(null),ref:n.ref(null)},elements:n.ref([]),draggingElements:n.ref([]),selectedElements:n.ref([]),zones:n.ref([]),hovered:{zone:n.ref(null),element:n.ref(null)},pointerPosition:{current:n.ref(null),start:n.ref(null),offset:{percent:n.ref(null),pixel:n.ref(null)}}})),q=!0),H),W=()=>{const t=n.ref(null),{draggingElements:e,pointerPosition:l,isDragging:u,activeContainer:d}=M();return n.onMounted(()=>{d.ref=t}),n.onBeforeUnmount(()=>{d.ref.value=null}),{elementRef:t,draggingElements:e,pointerPosition:l,isDragging:u}},ee=["innerHTML"],te=n.defineComponent({__name:"DefaultOverlay",setup(t){const{elementRef:e,pointerPosition:l,isDragging:u,draggingElements:d}=W(),o=n.computed(()=>{var r,i,f,m;return{transform:`translate3d(${(((r=l.current.value)==null?void 0:r.x)??0)-(((i=l.offset.pixel.value)==null?void 0:i.x)??0)}px, ${(((f=l.current.value)==null?void 0:f.y)??0)-(((m=l.offset.pixel.value)==null?void 0:m.y)??0)}px, 0)`,zIndex:1e3,position:"fixed",top:0,left:0,transition:"0.3s cubic-bezier(0.165, 0.84, 0.44, 1)"}});return(r,i)=>n.unref(u)?(n.openBlock(),n.createElementBlock("div",{key:0,ref_key:"elementRef",ref:e,style:n.normalizeStyle(o.value)},[(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(n.unref(d),(f,m)=>{var s,g;return n.openBlock(),n.createElementBlock("div",{key:m,innerHTML:f.initialHTML,style:n.normalizeStyle({width:`${(s=f.initialRect)==null?void 0:s.width}px`,height:`${(g=f.initialRect)==null?void 0:g.height}px`})},null,12,ee)}),128))],4)):n.createCommentVNode("",!0)}}),ne=n.defineComponent({__name:"DragOverlay",setup(t){const{activeContainer:e}=M(),l=n.computed(()=>e.component.value??te);return(u,d)=>(n.openBlock(),n.createBlock(n.resolveDynamicComponent(l.value)))}}),re=(t,e,l={})=>{const{threshold:u=50,speed:d=10,disabled:o=!1}=l,r=n.ref(!1);let i=null,f=null;const s=1e3/144;let g=null,h=0,E=0;const a=p=>{if(!t.value||!e.value||o){r.value=!1;return}f||(f=p);const y=p-f;if(y<s){i=requestAnimationFrame(a);return}const S=y/s,P=d*S;f=p;const L=t.value.scrollTop,R=t.value.scrollLeft;(!g||h!==L||E!==R)&&(g=t.value.getBoundingClientRect(),h=L,E=R);let I=!1;e.value.y-g.top<u&&(t.value.scrollTop=h-P,I=!0),g.bottom-e.value.y<u&&(t.value.scrollTop=h+P,I=!0),e.value.x-g.left<u&&(t.value.scrollLeft=E-P,I=!0),g.right-e.value.x<u&&(t.value.scrollLeft=E+P,I=!0),r.value=I,I&&(i=requestAnimationFrame(a))},w=()=>{i&&(cancelAnimationFrame(i),i=null),g=null,h=0,E=0,f=null,r.value=!1};return n.watch(e,p=>{p?(i&&cancelAnimationFrame(i),f=null,a(performance.now())):w()}),n.watch(()=>o,p=>{p&&w()}),{isScrolling:r}},A=(t,e)=>t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y,O=t=>{if(!t)return{x:0,y:0,width:0,height:0,bottom:0,left:0,right:0,top:0};const e=t.getBoundingClientRect();return{bottom:e.bottom,left:e.left,right:e.right,top:e.top,x:e.x,y:e.y,width:e.width,height:e.height}},F=t=>({x:t.x+t.width/2,y:t.y+t.height/2}),oe=(t,e)=>{const l=O(t);return{pixel:{x:e.x-l.x,y:e.y-l.y},percent:{x:(e.x-l.x)/l.width*100,y:(e.y-l.y)/l.height*100}}},le=t=>{const l=Math.atan2(t.y,t.x)*(180/Math.PI);return l>=-45&&l<=45?"right":l>45&&l<135?"down":l>=135||l<=-135?"left":"up"},Z=(t,e)=>{const l=e.x-t.x,u=e.y-t.y;return Math.sqrt(l*l+u*u)},se=(t,e={})=>{const{reset:l=!0,windowResize:u=!0,windowScroll:d=!0}=e,o=n.shallowRef({x:0,y:0,width:0,height:0,bottom:0,left:0,right:0,top:0}),r={resize:null,mutation:null},i=()=>{if(!t.value){l&&(o.value={x:0,y:0,width:0,height:0,bottom:0,left:0,right:0,top:0});return}o.value=O(t.value)},f=()=>{var h,E;(h=r.resize)==null||h.disconnect(),(E=r.mutation)==null||E.disconnect(),r.resize=null,r.mutation=null},m=()=>{t.value&&(f(),r.resize=new ResizeObserver(i),r.resize.observe(t.value),r.mutation=new MutationObserver(i),r.mutation.observe(t.value,{attributes:!0,attributeFilter:["style","class"],characterData:!1,childList:!1,subtree:!1}),i())},s=()=>{d&&window.addEventListener("scroll",i,{capture:!0,passive:!0}),u&&window.addEventListener("resize",i,{passive:!0})},g=()=>{d&&window.removeEventListener("scroll",i),u&&window.removeEventListener("resize",i)};return n.watch(()=>t.value,(h,E)=>{E!==h&&(!h&&l&&(o.value={x:0,y:0,width:0,height:0,bottom:0,left:0,right:0,top:0}),m())},{immediate:!0}),s(),n.onBeforeUnmount(()=>{f(),g()}),o},ie="data-dnd-draggable",ae=t=>{const{elements:e,draggingElements:l,hovered:u,selectedElements:d,isDragging:o}=M(),r=n.ref(null),i=n.computed(()=>{var h;return((h=u.element.value)==null?void 0:h.node)===r.value}),f=n.computed(()=>l.value.some(h=>h.node===r.value)),m=n.computed(()=>{if(!r.value||!o.value)return!1;const h=e.value.find(E=>E.node===r.value);return h!=null&&h.groups.length?!l.value.some(E=>E.groups.length?!E.groups.some(a=>h.groups.includes(a)):!1):!0});return{elementRef:r,registerElement:()=>{if(!r.value)throw new Error("ElementRef is not set");e.value.push({node:r.value,groups:(t==null?void 0:t.groups)??[],layer:(t==null?void 0:t.layer)??null,defaultLayer:(t==null?void 0:t.layer)??null,events:(t==null?void 0:t.events)??{},data:(t==null?void 0:t.data)??void 0}),r.value.setAttribute(ie,"true")},unregisterElement:()=>{const h=e.value.findIndex(a=>a.node===r.value);h!==-1&&e.value.splice(h,1);const E=d.value.findIndex(a=>a.node===r.value);E!==-1&&d.value.splice(E,1)},isDragging:f,isOvered:i,isAllowed:m}},ce=()=>{let t="",e="",l="";const u=()=>{const r=document.body;t=r.style.userSelect,e=r.style.touchAction,l=r.style.overscrollBehavior,r.style.userSelect="none",r.style.touchAction="none",r.style.overscrollBehavior="none",window.addEventListener("contextmenu",o),window.addEventListener("selectstart",o),window.addEventListener("touchstart",o),window.addEventListener("touchmove",o)},d=()=>{const r=document.body;r.style.userSelect=t,r.style.touchAction=e,r.style.overscrollBehavior=l,window.removeEventListener("contextmenu",o),window.removeEventListener("selectstart",o),window.removeEventListener("touchstart",o),window.removeEventListener("touchmove",o)},o=r=>r.preventDefault();return{disableInteractions:u,enableInteractions:d}},C=(t,e)=>t?e.contains(t):!1,ue=t=>{const e=M();return{onPointerStart:o=>{e.pointerPosition.start.value={x:o.clientX,y:o.clientY},e.pointerPosition.current.value={x:o.clientX,y:o.clientY};const{pixel:r,percent:i}=oe(t.value,{x:o.clientX,y:o.clientY});e.pointerPosition.offset.pixel.value=r,e.pointerPosition.offset.percent.value=i},onPointerMove:o=>{e.pointerPosition.current.value={x:o.clientX,y:o.clientY}},onPointerEnd:()=>{e.pointerPosition.current.value=null,e.pointerPosition.start.value=null,e.pointerPosition.offset.pixel.value=null,e.pointerPosition.offset.percent.value=null}}},de=t=>{const e=M(),{onPointerStart:l,onPointerMove:u,onPointerEnd:d}=ue(t);let o=null;const r=a=>{var y,S;const w=e.selectedElements.value.some(P=>P.node===a);if(e.selectedElements.value.length&&w)return e.selectedElements.value.map(P=>{var L,R;return{...P,initialHTML:((L=P.node)==null?void 0:L.outerHTML)??"",initialRect:(R=P.node)==null?void 0:R.getBoundingClientRect()}});e.selectedElements.value=[];const p=e.elements.value.find(P=>P.node===a);return p?[{...p,initialHTML:((y=p.node)==null?void 0:y.outerHTML)??"",initialRect:(S=p.node)==null?void 0:S.getBoundingClientRect()}]:[]},i=(a,w)=>{const p=Math.max(0,Math.min(a.x+a.width,w.x+w.width)-Math.max(a.x,w.x)),y=Math.max(0,Math.min(a.y+a.height,w.y+w.height)-Math.max(a.y,w.y)),S=p*y,P=a.width*a.height,L=w.width*w.height;return(S/P*100+S/L*100)/2},f=()=>{var X,Y,$,V,j,G,N,J,K,Q;const a=O(e.activeContainer.ref.value),w=F(a),p=((X=e.pointerPosition.current.value)==null?void 0:X.x)??0,y=((Y=e.pointerPosition.current.value)==null?void 0:Y.y)??0,P=!(a&&p>=a.x&&p<=a.x+a.width&&y>=a.y&&y<=a.y+a.height),L=e.draggingElements.value.map(c=>c.node),R=e.elements.value.filter(c=>{if(!c.node||L.some(D=>D&&C(c.node,D))||c.groups.length&&!!e.draggingElements.value.some(z=>z.groups.length?!z.groups.some(T=>c.groups.includes(T)):!1))return!1;const v=O(c.node);return v&&a&&A(v,a)}).map(c=>{const v=O(c.node),D=F(v),z=p>=v.x&&p<=v.x+v.width&&y>=v.y&&y<=v.y+v.height,T=i(v,a),b=Z(w,D),U=e.elements.value.filter(_=>_!==c&&_.node&&c.node&&C(c.node,_.node)).length;return{element:c,isPointerInElement:z,overlapPercent:T,depth:U,centerDistance:b}}).sort((c,v)=>{if(!P){if(c.isPointerInElement&&v.isPointerInElement)return v.depth-c.depth;if(c.isPointerInElement!==v.isPointerInElement)return c.isPointerInElement?-1:1}return Math.abs(c.overlapPercent-v.overlapPercent)<=1?c.centerDistance-v.centerDistance:v.overlapPercent-c.overlapPercent}),I=e.zones.value.filter(c=>{if(!c.node||L.some(D=>D&&C(c.node,D))||c.groups.length&&!!e.draggingElements.value.some(z=>z.groups.length?!z.groups.some(T=>c.groups.includes(T)):!1))return!1;const v=O(c.node);return v&&a&&A(v,a)}).map(c=>{const v=O(c.node),D=F(v),z=p>=v.x&&p<=v.x+v.width&&y>=v.y&&y<=v.y+v.height,T=i(v,a),b=Z(w,D),U=e.zones.value.filter(_=>_!==c&&_.node&&c.node&&C(c.node,_.node)).length;return{zone:c,isPointerInElement:z,overlapPercent:T,depth:U,centerDistance:b}}).sort((c,v)=>{if(!P){if(c.isPointerInElement&&v.isPointerInElement)return v.depth-c.depth;if(c.isPointerInElement!==v.isPointerInElement)return c.isPointerInElement?-1:1}return Math.abs(c.overlapPercent-v.overlapPercent)<=1?c.centerDistance-v.centerDistance:v.overlapPercent-c.overlapPercent}),k=e.hovered.element.value,B=e.hovered.zone.value;e.hovered.element.value=(($=R[0])==null?void 0:$.element)??null,e.hovered.zone.value=((V=I[0])==null?void 0:V.zone)??null,e.hovered.element.value!==k&&((j=k==null?void 0:k.events)!=null&&j.onLeave&&k.events.onLeave(e),(N=(G=e.hovered.element.value)==null?void 0:G.events)!=null&&N.onHover&&e.hovered.element.value.events.onHover(e)),e.hovered.zone.value!==B&&((J=B==null?void 0:B.events)!=null&&J.onLeave&&B.events.onLeave(e),(Q=(K=e.hovered.zone.value)==null?void 0:K.events)!=null&&Q.onHover&&e.hovered.zone.value.events.onHover(e)),o=requestAnimationFrame(f)},m=()=>{f()},s=()=>{o!==null&&(cancelAnimationFrame(o),o=null)};return{activate:a=>{e.draggingElements.value=r(t.value),l(a),m()},track:a=>{u(a)},deactivate:()=>{var a,w;d(),e.hovered.zone.value?(w=(a=e.hovered.zone.value.events).onDrop)==null||w.call(a,e):e.draggingElements.value.forEach(p=>{var y,S;return(S=(y=p.events).onEnd)==null?void 0:S.call(y,e)}),e.draggingElements.value=[],e.selectedElements.value=[],e.hovered.zone.value=null,e.hovered.element.value=null,s()}}},ve=t=>{const{elementRef:e,registerElement:l,unregisterElement:u,isDragging:d,isOvered:o,isAllowed:r}=ae(t),{disableInteractions:i,enableInteractions:f}=ce(),m=M(),{activate:s,track:g,deactivate:h}=de(e),E=y=>{t!=null&&t.container&&(m.activeContainer.component.value=n.markRaw(t.container)),i(),s(y),document.addEventListener("pointermove",a),document.addEventListener("pointerup",p),document.addEventListener("wheel",w)},a=y=>{g(y)},w=y=>{g(y)},p=()=>{m.activeContainer.component.value=null,f(),h(),document.removeEventListener("pointermove",a),document.removeEventListener("pointerup",p),document.removeEventListener("wheel",w)};return n.onMounted(l),n.onBeforeUnmount(u),{pointerPosition:m.pointerPosition,elementRef:e,isDragging:d,isOvered:o,isAllowed:r,handleDragStart:E}},fe=t=>{const{zones:e,hovered:l,draggingElements:u,isDragging:d}=M(),o=n.ref(null),r=n.computed(()=>{var s;return((s=l.zone.value)==null?void 0:s.node)===o.value}),i=n.computed(()=>{if(!o.value||!d.value)return!1;const s=e.value.find(g=>g.node===o.value);return s!=null&&s.groups.length?!u.value.some(g=>g.groups.length?!g.groups.some(h=>s.groups.includes(h)):!1):!0});return{elementRef:o,registerZone:()=>{if(!o.value)throw new Error("elementRef is not set");e.value.push({node:o.value,groups:(t==null?void 0:t.groups)??[],events:(t==null?void 0:t.events)??{},data:(t==null?void 0:t.data)??void 0}),o.value.setAttribute("data-dnd-droppable","true")},unregisterZone:()=>{if(!o.value)throw new Error("elementRef is not set");const s=e.value.findIndex(g=>g.node===o.value);s!==-1&&e.value.splice(s,1)},isOvered:r,isAllowed:i}},ge=t=>{const{elementRef:e,registerZone:l,unregisterZone:u,isOvered:d,isAllowed:o}=fe(t);return n.onMounted(l),n.onBeforeUnmount(u),{elementRef:e,isOvered:d,isAllowed:o}};function he(t,e,l={}){const{immediate:u=!0}=l;let d=null;const o=()=>{d&&(d.disconnect(),d=null)},r=()=>{if(t.value&&(o(),d=new ResizeObserver(([i])=>{i&&e(i)}),d.observe(t.value),u)){const i=t.value.getBoundingClientRect();e({contentRect:i,target:t.value,borderBoxSize:[],contentBoxSize:[],devicePixelContentBoxSize:[]})}};return n.watch(()=>t.value,i=>{i?r():o()},{immediate:!0}),n.onBeforeUnmount(o),o}function me(t,e={width:0,height:0}){const l=n.shallowRef(e.width),u=n.shallowRef(e.height);return he(t,d=>{l.value=d.contentRect.width,u.value=d.contentRect.height},{immediate:!0}),{width:l,height:u}}const pe=(t,e)=>{const l=n.computed(()=>{var r,i,f,m;return{x:(((r=e.value)==null?void 0:r.x)??0)-(((i=t.value)==null?void 0:i.x)??0),y:(((f=e.value)==null?void 0:f.y)??0)-(((m=t.value)==null?void 0:m.y)??0)}}),u=n.computed(()=>le(l.value)),d=n.computed(()=>{var f,m,s,g;const r=(((f=e.value)==null?void 0:f.x)??0)-(((m=t.value)==null?void 0:m.x)??0),i=(((s=e.value)==null?void 0:s.y)??0)-(((g=t.value)==null?void 0:g.y)??0);return Math.sqrt(r*r+i*i)}),o=n.computed(()=>{var f,m,s,g;const r=(((f=e.value)==null?void 0:f.x)??0)-(((m=t.value)==null?void 0:m.x)??0),i=(((s=e.value)==null?void 0:s.y)??0)-(((g=t.value)==null?void 0:g.y)??0);return Math.atan2(i,r)*(180/Math.PI)});return{delta:l,direction:u,distance:d,angle:o}},ye=t=>{const{selectedElements:e,elements:l}=M(),u=n.computed(()=>l.value.find(s=>s.node===t.value)),d=n.computed(()=>e.value.some(s=>s.node===t.value)),o=n.computed(()=>t.value?e.value.some(s=>s.node&&C(s.node,t.value)):!1),r=n.computed(()=>t.value?e.value.some(s=>s.node&&C(t.value,s.node)):!1),i=()=>{u.value&&(e.value=e.value.filter(s=>s.node!==t.value))},f=()=>{u.value&&(o.value&&(e.value=e.value.filter(s=>s.node&&!C(s.node,t.value))),r.value&&(e.value=e.value.filter(s=>s.node&&!C(t.value,s.node))),e.value.push(u.value))};return{handleUnselect:i,handleSelect:f,handleToggleSelect:()=>{u.value&&(e.value.some(s=>s.node===t.value)?i():f())},isSelected:d,isParentOfSelected:o}};x.DragOverlay=ne,x.useAutoScroll=re,x.useBounding=se,x.useDnDStore=M,x.useDrag=ve,x.useDrop=ge,x.useElementSize=me,x.useGeometry=pe,x.useSelectionManager=ye,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});
